# 项目开发规范总结

## 数据模型规范
- **状态字段默认值**：所有状态相关字段默认值必须为0，且0必须表示关闭/禁用状态
- **状态字段定义**：定义模型时如有状态等类似字段，必须添加注释标识（如：0=禁用 1=开启），类型必须是`*int`或`*string`

## 命名规范
- **变量命名**：项目中所有变量命名采用驼峰命名法（camelCase）

## 路由规范
- **路由格式**：只允许`/api/user/:id`格式（ID参数必须在路径末尾）
- **错误格式**：禁止使用`/api/:id/user`格式
- **GET方法参数**：GET方法不允许使用`/api/user/:id`方式获取数据，必须使用查询参数格式`/api/user?id=1`

## 返回值规范
- **统一返回格式**：所有返回值必须使用`vo`包中的`Response`结构体

## 错误处理规范
- **错误返回**：所有错误必须使用`errors.New("错误信息")`来返回

## 日志规范
- **日志库**：所有日志必须使用`pkg/logger`库来打印

## 数据库操作规范
- **数据库操作**：所有数据库操作必须使用`service`包中的方法
- **单字段查询**：查询数据库单个字段需要使用gorm中的`Find`而不是`First`（避免查询错误）

## 控制器规范
- **控制器使用**：所有控制器必须使用`controller`包中的方法

## 项目结构规范
- **开发位置**：上手开发时必须在`module`分包开发，不允许在`system`下直接开发
- **框架修改**：不推荐修改项目框架（违背项目设计初衷）
- **功能分层**：
  - `module`：编写API接口逻辑
  - `plugin`：对外对接需要发送API操作建议直接封装成plugin
  - `pkg`：二次封装社区包

## CRUD接口标准格式

### ⚠️ 重要：ListAll接口使用限制
**🚨 ListAll接口仅在以下情况下才能使用：**
- 数据量确定很小（如角色表、字典表等配置类数据）
- 与其他模型有关联关系（如下拉选择框数据源）

**❌ 禁止在用户表、日志表等大数据量表中使用ListAll接口**

### 标准CRUD接口格式
```go
// 基础CRUD接口（所有模型必须实现）
auth.Put("模型名/:id", controller.模型Ctl.Put)      // 更新
auth.Post("模型名", controller.模型Ctl.Add)         // 新增
auth.Delete("模型名/:id", controller.模型Ctl.Del)   // 删除
auth.Get("模型名", controller.模型Ctl.Get)          // 获取单个
auth.Get("模型名/list", controller.模型Ctl.List)    // 获取列表（分页）

// 可选接口（按需实现）
auth.Get("模型名/list/all", controller.模型Ctl.ListAll) // 获取所有（仅在符合条件时使用）
auth.Get("模型名/status", controller.模型Ctl.GetStatus) // 获取状态说明（有Status字段时必须实现）
```

### Status字段强制要求
**如果模型包含Status字段，必须额外提供GetStatus接口用于获取状态值说明**

## AI开发规范
- **不确定处理**：遇到不确定、无上下文、无规范等需要抉择的情况时，必须重新阅读项目所有代码
- **文件权限**：AI在此项目开发只能操作`/pkg`、`/plugin`、`/module/*`（除开system），其他文件需要用户允许
- **需求执行**：必须按照用户需求行事，在不确定问题上需要二次确认，不能私自扩展功能

## 插件开发规范
- **插件结构**：插件必须按照以下结构组织
  - `plugin/插件名.go` - 接口定义、常量、工厂函数、全局管理函数
  - `plugin/internal/插件名_impls.go` - 具体实现类
  - `plugin/init.go` - 统一注册所有插件实现
- **接口分离**：接口定义与具体实现必须分离，接口在外层，实现在internal包
- **命名规范**：实现类命名格式为`功能名算法名Impl`，如`CryptoMD5Impl`、`StorageLocalImpl`
- **注册模式**：所有插件实现必须在`plugin/init.go`中统一注册
- **工厂模式**：使用工厂函数创建实例，支持动态切换实现
- **全局管理**：提供`Init插件名(type string)`和`Get插件名()`函数进行全局管理
- **线程安全**：使用互斥锁保证并发安全

## 开发规范文档引用
- **插件开发**：必须严格按照插件开发规范进行，详细规范见`plugin-development-standards.md`文档
- **CRUD接口开发**：必须严格按照CRUD接口开发规范进行，详细规范见`crud-interface-standards.md`文档

## 意见建议格式
如果AI有扩充想法和意见，在回复末尾可以请求用户，格式为：
```
（应该需要xxx 作用为xxx 优点在于xxx）
```
